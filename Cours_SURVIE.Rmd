---
title: "Cours SURVIE"
author: "William Legendre"
date: "2022-11-19"
output: 
  html_document: 
    toc: yes
    highlight: espresso
    theme: readable
    number_sections: yes
---

1/ **Identifier** la pr√©sence de **donn√©es censur√©es** en √©pid√©miologie clinique et la n√©cessit√© d‚Äôanalyses de type analyse de survie

2/ Etre capable d‚Äô**estimer la survie de mani√®re non param√©trique** det de **construire des courbes de survie et de comparer deux ou plusieurs courbes de survie par un test du log rank**

3/ Savoir **planifier un essai** avec un **crit√®re de jugement ** ***censur√© (taille d‚Äô√©chantillon)***

4/ Savoir **construire un mod√®le de r√©gression √† risques proportionnels de Cox**, ***univariable et multivariable, et v√©rifier ses hypoth√®ses***

5/ **Identifier** les situations d‚Äô***√©v√©nements en comp√©titions*** et connaitre les **m√©thodes sp√©cifiques adapt√©es**


**POURQUOI UN INT√âR√äT AUX DONN√âES DE SURVIE ?**

- M√©thode sp√©cifique
- Etude de facteur **pronostiques** c a d survenu d'un event
- ***Comparaison de traitements***  (essais randomis√©s)  avec comme crit√®re une survenue d'un event quelconque : d√©c√®s, sortie de r√©a, sortie d'hopital, J14, J28, J90 ...

Implication sur la "survie" et les effets mesur√©es... Part attribuables √† la prise en charge de la pathologie aigue/ chronique sous-jacente.

#  Mortalit√© / Survie

Ces % (vivants/d√©c√®s) s'interpr√®te comme des mesures de ***pr√©valences***.

- Quantifie le probl√®me dans une **population homog√®ne**
- C'est une **probabilit√© [0,1]**
- La date/ l'instant de survenue de l'event ne nous int√©resse pas.
  - Une mesure de pr√©valence ne s'int√©resse qu'√† l'√©tat **final** ou a un instant donn√© de la population (Marmite de la pr√©valence de Morton)
- *Suppose* un **temps de suivi/d'obs identique pour tous** (la dur√©e d'exposition n'intervient pas)
  - Temps de suivie pour tous = **d√©terministe** (dates fix√©es √† priori)
  - Sortie de l'USI ou de l'h√¥pital = **al√©atoire** (dates non fixes)
  - Date calendaire ("date de point") = **al√©atoire** (suivi diff√©rent entre sujets)
  - **Penser au temps de d√©but d'inclusion, fin d'inclusion .... fin d'√©tude.**
  
  
  ![Plot title. ](Cours_SURVIE_insertimage_3.png)
  


#  Pour prise en compte des dates d'√©v√©nements

**Incidence** : mesure de la ***vitesse d'apparition des (nouveaux) cas*** dans une population (+++ maladie chronique [h√©matologie])

- Epid√©miologie : survenue de maladie chez sujets *sains*
- Epid√©miologie *clinique* : survenue d'un event chez des *malades*

On s'int√©resse l'**incidence cumul√©e**

- **Proportion cumul√©e de sujet avec (ou sans) en fonction du temps**
- N√©cessite un suivi avec recueil de date d'event

  
# Particularit√© des donn√©es de survie [D√©finitions, Probabilit√©s, Censure (indiqu√© par +)]

1) Donn√©e (d√©lai) de survie

Exemple: **d√©lai de survenue du d√©c√®s** = d√©lai entre 2 √©tats diff√©rents : vivant -> d√©c√®s

2) Calcul √† partir de dates

On d√©finit le d√©lai de survie comme la diff√©rence entre 2 dates

![Plot title. ](Cours_SURVIE_insertimage_4.png)

3) D√©finition du terme : ***Donn√©es de survie*** (Survival time, failture time, time to event data)

- D√©lai de survenue d'un event (*endpoint*) en ***tout ou rien***
- Tout d√©lai entre deux dates d'int√©ret
- Tout d√©lai de transition entre 2 √©tats
  - A l'instant initial, tous sont dans un *√©tat 0* (naissance, inclusion, r√©mission, admission...)
  - On s'int√©resse √† la transition vers l'*√©tat 1* (maladie, d√©c√®s, rechute, rechute et d√©c√®s, sortie)
    - N√©cessite de d√©finir pr√©cisement les dates √©tudi√©s
    - ***Event d'int√©r√™t est l'√©tat final***
    - ***Ne pas oublier l'√©tat initial***
  - La fen√™tre d'observation des individus a son importance pour l'**inf√©rence statistique**
    - A l'origine des particularit√©s des donn√©es de survie
  
## Loi des probabilit√© du d√©lai de survie

Soit **T** variable al√©atoire mod√©lisant un d√©lai de survie

**3 sp√©cificit√©s** :

1) ***Positive***
2) Distribution ***ASYMETRIQUE***
3) Peut-√™tre non observ√©e ***CENSURE***

- **Positive et Asym√©trique**
  - D√©lai entre 2 dates
  - Mesur√© le plus souvent en jours
  - Souvent assimilable a une **variable continue**

![Plot title. ](Cours_SURVIE_insertimage_5.png)

  - **Cons√©quence**
    - La moyenne est un "mauvais" param√®tre pour d√©crire une distribution de survie
    - **Pr√©f√©rer** la **m√©diane**
    - La moyenne est "mauvaise" pour d√©crire un d√©lai √† cause de l'asym√©trie
    - Calcu√©e sur les seuls morts, elle est une repr√©sentation erron√©e de la survie de l'ensemble des malades √©tudi√©s
    - Mod√®le statistique Gaussien non adapt√© ***sauf*** apr√®s transformation (exp, log(T))
    - ***Familles param√©triques adapt√©es : Exponentielle, Weibull...***
    
## Loi de probabilit√© de T

***Fonction de survie*** : **S(t)** est le *compl√©ment de la fonction de r√©partition cumul√©e.*

- Elle d√©crit la probabilit√© de ne pas √©chouer ou de survivre jusqu'√† un certain temps t.

Egalement **d√©crite par l'une de ces 5 fonctions**: (diapo cours 1, a partir de 27), lien clair d√©but diapo 2 dans les rappels)
 
1) Densit√© de probabilit√© : **f(t)**
- Si T est discr√®te fonction de masse.

2) Fonction de r√©partition : **F(t)**
- **Monotone croissante de 0 √† 1**
- C'est une primitive de f(x)

3) Fonction de survie : **S(t)**
- **Monotone d√©croissante de 0 √† 1**
- A + l'infini, toute la population a pr√©sent√© l'event

4) Fonction de **Risque instantann√©e** (**hazard** ou *intensity ou rate*) : h**(t) [ùùÄ(t)]**
- Densit√© **conditionnelle** (a la survie en t)
  - S'interpr√™te comme la probabilit√© de d√©ceder sur un petit intervalle de temps alors qu'on √©tait vivant au d√©but de l'intervalle (√©tude du vieillissement)
  
5) Fonction de **Risque cumul√©e** (*cumulative hazard*) : **H(t) [Œõ(t)]**


***S(t) + F(t) = 1***

### Int√©r√™t des fonctions de risques instantan√© et de risque cumul√©

  - Interpr√©tation en termes de **probabilit√©s conditionnelles**
    - Exemple: T, d√©lai de rechute apr√®s chirurgie
    - Int√©r√™t de **quantifier probabilit√© d'event si le malade n'a pas rechut√© avant**
    
  - Interpr√©tation de l'**effet du temps sur la survenue de l'event**
    - Choix de mod√©lisation param√©trique
  - **Simplification analytique**
    - Fonction de **risque cumul√©**
    
  - Simplification de mod√©lisation
    - **Mod√®les de r√©gression** pour la fonction de **risque instantan√©**
    
***Int√©r√™t de l'√©tude de la fonction de risque (instantan√©) comme fonction du temps +++***
- Si constant: pas de vieillissement (pex: forte mortalit√©)
- Si croissante: vieillissement (pex: faible mortalit√© li√©e √† la maladie)
- Si d√©croissante: "*n√©gative aging* (pex: surmortalit√© li√©e au traitement [chirurgie majeur...])

- L'Esperance de T E(t) est l'*Aire sous S(t)*, c'est un mauvais param√®tre de position

Le **TwIST** = Time without Symptoms & Treatment toxicities : (esp√©rance du) Temps de s√©jour sans symptomes ni toxicit√©. C'est une moyenne d√©finie sur intervalle de temps tronqu√© (mean restricted life)

![Plot title. ](Cours_SURVIE_insertimage_7.png)

La **m√©diane** de la dur√©e de survie est le temps t pour lequel la probabilit√© de surie **S(t) = 0.5** c a d la valeur tm qui satisfait S(tm) = 0.5. Dans le cas o√π l'estimateur est une ***fonction en escalier (pex : Kaplan-Meier)***, il se peut qu'il y ait un intervalle de temps v√©rifant S(tm) = 0.5. Il faut alors √™tre prudent dans l'interpr√©tation, notamment si les deux √©v√©nements encadrant le temps m√©dian sont √©loign√©s


### Familles param√©triques pour T

Selon la forme attendu de **ùùÄ(t)**
- Loi exponentielle
- Loi de **Weibull**
- Loi **logligistique**
- Loi lognormale
- ...

***Int√©r√™t de tracer log H(t)*** 

- Int√©r√™t de la loi **exponentielle**
  - **Risque constant**
    - Ignore le vieillissement ("ageless") : "sans m√©moire"
    - **Int√©r√™t si l'event survient √† risque constant**
    
- Int√©r√™t du mod√®le de **Weibull** (Œª, Œ≤ [scale, shape])
  - D√©fini par **Œª(t) = Œª * Œ≤ * t^(Œ≤ - 1)**
  - Œ≤ : pente. Si 
    - Œ≤ < 1 : risque d√©croissant
    - Œ≤ > 1 : risque croissant
    - Œ≤ = 1 : risue constant
    
    ![Plot title. ](Cours_SURVIE_insertimage_8.png)
    ![Plot title. ](Cours_SURVIE_insertimage_9.png)
    
- Int√©r√™t de la loi **log normale** : Log(T) ~N (Œº, œÉ)
  - Fonction de **risque non monotone** 
    - **Augmente avec le temps jusqu'√† un maximum, puis diminue**  (souvent apr√®s la m√©diane)
    
    
## Incompl√®tement observ√©e - Censure 

**T** d√©lai de survie d'int√©r√™t
**C** temps d'observation

**Observation incompl√®tes** = non observation du d√©lai d'event = observations **CENSUREES**

La **censure** est un probl√®me de **donn√©es manquantes** avec de l'information !

### **CENSURE A DROITE** : ***C < T***

***Non survenue de l'event*** en fin d'observation (pex: √©tude du d√©lai de survie, tous les sujets ne sont pas d√©c√©d√©s dans la cohorte en fin de suivi)

L'event d'un individu i, n'est observ√© que sur un sous ensemble [O, Ci[
Donn√©es observ√©es:

X = min(T,C)
ùõø= 1(T<= C)

![Plot title. ](Cours_SURVIE_insertimage_11.png)

***3 types***:

1) Type I: ***fixe***
- Dur√©e d'obs d√©lai C de censure) pr√©d√©termin√© pour tous : Ci = u
  - Xi = min(Ti, u) et ùõø= 1(Ti <= u)
    - Etude exp√©rimentale animale avec sacrifice des animaux a date fixe
    - Etude clinique avec crit√®re √©valu√© √† une m√™me date (ex: mortalit√© √† J28)
    
2) Type II: ***s√©quentielle***
- Dur√©e d'obs C de censure est interrompue apr√®s obs d'un nombre fixe **r** pr√©d√©termin√© d'event
  - Xi = min(Ti, T^r) et ùõø= 1(Ti<= T^r)
    - Etude de fiabilit√© de mat√©riel
    
3) Type III: ***al√©atoire***
- Dur√©e d'obs C de censure **al√©atoire**
  - Xi = min(Ti, Ci) et ùõø= 1(Ti <= Ci)
    - **Mod√©lisation des donn√©es de cohorte**
    - Suppose de plus que les variables de censure et de survie sont **ind√©pendantes en probabilit√©s.** Pour s'assurer d'une censure al√©atoire ind√©pendante: d√©finir une*** ***date de point*** **de l'analyse des donn√©es**

![Plot title. ](Cours_SURVIE_insertimage_12.png)

- ***Censure ADMINISTRATIVE***
  - Al√©atoire ET ind√©pendante
  - Assur√© par le choix d'une date de point("exclus-vivant")
  
  ![Plot title. ](Cours_SURVIE_insertimage_13.png)
  
  - ***Censure NON ADMINISTRATIVE***
    - Al√©atoire *mais* parfois li√©e au risque d'event du sujet
    - D√©finie par l'**abscence de suivi du sujet √† la date de point**
    - On parle de **perdu de vue**
    - Chercher causes d'interruption du suivi pour s'assurer de son **ind√©pendance** +++


#### ***PRINCIPE DE LA DATE DE POINT*** (pour la censure a droite)

Evaluer l'√©tat des sujets √† une date (calendaire) fixe.
On tronque les donn√©es apr√®s cette date.
Objectif : s'assurer une **CENSURE INDEPENDANTE** dite ***ADMINISTRATIVE***


### **CENSURE A GAUCHE** : ***T < C***

Survenue de l'event ***AVANT*** avant l'observation (pex: √©tude de l'√¢ge aux 1√®re r√®gles, on interroge une femme qui a "oubli√©" la date de ses 1√®re r√®gles).

L'observation de l'event est limit√© a un sous-ensemble Ei de la forme (Vi, œÑ), Vi > 0

Pex: d√©lai de descente des babouins depuis un arbre. Au moment de l'observation, les babouins sont d√©j√† descendu de l'arbre. 

![Plot title. ](Cours_SURVIE_insertimage_14.png)
####***ATTENTION DIFFERENCES ENTRE CENSURE ET TRONCATURE***

***Censure*** *obs incompl√®te* d'une **population compl√®te**

***Troncature*** *objs compl√®te* d'une **population incompl√®te**
  - Souvent a Gauche "delayed entry"
  - Pex: estimation d'un d√©lai de survie post diagnostic √† partir d'un √©chantillon initi√© au d√©but du traitement.
    - Pour √™tre analys√©es, les sujets doivent avoir un temps de survie > temps de d√©but de traitement. Donc les sujets d√©c√©d√©s avant traitement sont exclus.

### **CENSURE PAR INTERVALLE** : ***C1 < T < C2*** 

Survenue de l'event entre 2 instants d'observation


# ESTIMATION DE LA FONCTION DE SURVIE | Param√©trique et Non param√©trique

**Estimation de S(t)**

**But**: d'√©crire la distribution des d√©lais de survie
Quantit√© d'int√©r√™t est la fonction de survie
**S(t) = P(d√©lai de survie > t)**
- D√©crit la population de survivants en t, comme une fonction de t
- pex, la proportion de sujets rest√©s dans l'√©tat 0, qui ne sont pas pass√©s a l'√©tat 1.

## Estimateur non param√©trique de S(t)

- En **absence de censure**
  - D√©duit de l'estimateur empirique de la fonction de r√©parition d'une variable al√©atoire
  - Fonction **monotone d√©croissante de 1 √† 0**
  - Allure "en marche d'escalier"

![Plot title. ](Cours_SURVIE_insertimage_15.png)
#### Kaplan Meier
- En **pr√©sence de censure** (fixe ou al√©atoire ind√©pendante / non informative)
  - G√©n√©ralisation de l'estimateur empirique
  - ***KAPLAN MEIER**
    - Utiliser toute l'information des donn√©es
    - Notamment les obs censur√©es: un sujet censur√© a au moins surv√©cu jusqu'√† son temps de censure (Ti > Ci)
    - **But** : Estimer la fonction de survie ("survival rate"), S(t) en pr√©sence de censure (ou non)
    - **Principe** : √ätre en vie √† 2 ans apr√®s inclusion c'est √™tre en vie 1 an apr√®s l'inclusion et ne pas d√©c√©der entre 1 et 2 ans
      - G√©n√©ralisation pour 2 temps, t1 et t2, avec t2 > t1
      - Il faut donc **estimer ces probabilit√©s condtionnelles**
      - Probabilit√© de faire l'event au temps yi, sachant qu'on ne l'a pas fait en yi-1 = nb d'event entre y-1 et yi parmi tous les sujets a risque au tempsp yi.
      - Probabilit√© de survie conditonnelle = 1 - (di / ni) avec di : d√©c√®s au temps i, et ni : patients en vie imm√©diatement avant le temps i.
      - **Remarque** : si le temps yi correspond √† une **censure** (Œ¥i = 0), il n'y a aucun event dans l'intervalle de yi-1 a yi donc cette probabilit√© vaut 1.
      - La **probabilit√© S(t) ne change qu'aux temps d'event (Œ¥i = 1)**
      - D√©fini sur tout l'intervalle des obs (et non en dehors)
      - Fonction monotone d√©croissante **de 1 √† 0** en **marches d'escalier**
      - Permet l'estimation **non biais√©e de la m√©diane (et de tout autre quantile)**
      - Suppose que tous les sujets de la population sont expos√©s √† **UN SEUL RISQUE** (pr√©senter la transmission vers l'√©tat 1), avec assez de temps on pourrait observer tout les temps de transition (pour d√©c√®s).
      - Prends en compte m√™me les individus vivants (rest√©s dans l'√©tat 0) en fin d'obs, ie, les censures suppos√©es NON informatives (de la probabilit√© de transition)

![Plot title. ](Cours_SURVIE_insertimage_16.png)

![Plot title. ](Cours_SURVIE_insertimage_17.png)


![Plot title. ](Cours_SURVIE_insertimage_18.png)

A pr√©ciser: pour la mesure de pr√©cision, indiquer le nb de sujets expos√©s au cours du temps.

**Pr√©cision : intervalle de confiande de S(t)**
- Estimation de l'√©cart-type de S(t) : m√©thode de Greewood : estime la probabilit√© qu'un individu survive sur l'intervalle d√©butant par t(j)
- Suppose une loi binomiale du nb de d√©c√®s sur l'intervalle d√©butant par tj
- Intervalle de confiance (1 - Œ±) pour S(t) (cours 2 dapo 51)








### Estimateur param√©trique

On choisit une famille de lois pour d√©crire la variable des **temps de survie T**

L'estimation devient celle d'un **param√®tre inconnu**

- **Estimateur du maximum de vraisemblance**
  - En **absence de censure**
    - Echantillon des obs (T1, T2, ...Tn) **ind√©pendante** et **√©quidistribu√©**
    - Mod√®le statistique dans une famille param√©trique ou fùúΩ(t) est la densit√© de probabilit√© T.
      - L(ùúΩ) est la vraisemblance des donn√©es
      - On chercher ùúΩ pour **maximiser L(ùúΩ)** 
      - En g√©n√©ral on travail sur log(L(ùúΩ)) c'est plus simple, et on veut **minimiser** log(L(ùúΩ)) en trouvant le point = a 0 en le d√©rivant.

**Estimation param√©trique en pr√©sence de CENSURE FIXE**

- Echantillon d'obs ind√©pendant
- Densit√© de probabilit√© de T
- La contribution des sujets a la vraisemblance d√©pend seulement de leur √©tat.

- Lorsqu'il y a densit√© de probalit√© T et C, alors la vraisemblence des donn√©es est modifi√©es car la censure est al√©atoire, et donc la contribution des sujets a la vraisemblance d√©pend de leur √©tat et de la censure.



**Estimation param√©trique en pr√©sence de CENSURE ALEATOIRE**

- Sous conditions sur le m√©canisme de censure
  - Concept probabiliste ce **censure ind√©pendante** on associe le concept statistique de **censure non informative**
  - Les donn√©es de censure apporte de l'information sur ùú∏mais n'apporte aucune information sur ùúΩ.
  - On parle de *vraisemblance partielle*

***Vraisemblance partielle***
- Sous hypoth√®se de censure al√©atoire et ind√©pendante (non informative), inf√©rence bas√©e sur la vraisemblance partielle des observations

Exemple: mod√®le exponentiel, mod√®le de Weibull (√©quation non lin√©aires : proc√©dures num√©riques it√©ratives - algo de Newton Raphson)




**Risque instantan√©** 
- h(t) aux temps entre t(j) et t(j+1) : h(t) = dj /ùëõjùúèj
  - dj : nb de d√©c√®s au j-i√®me temps de d√©c√®s
  - ùëõj : nb de patients √† risque au temps t(j)
  - ùúèj : t(j+1) - t(j) d√©lai entre deux d√©c√®s
  - Difficile √† estimer

**Risque cumul√©**
- Estimateur de Nelson - Aalen
- Autre estimateur : Fleming - Harrington
- Plus simple mais interpr√™tation difficile : nombre d'event attendus pour chaque individu au temps t si l'event √©tait un processus reproductible.


![Plot title. ](Cours_SURVIE_insertimage_19.png)



## Comparaison de 2 fonctions de survie

**Expliquer la mortalit√©: Comparaison**

*Entre morts et vivants*

***Test du log-rank***
- **But** : tester l'**√©galit√© des 2 distributions de survie** (et **non** de 2 taux de survie √† un temps donn√©)
- Test "**non param√©trique**" : ***AUCUNE HYPOTHESE A VERIFIER**
  - **Sauf CENSURE NON INFORMATIVE**
-Puissance maximale si les risques de d√©c√®s des 2 groupes sont **proportionnels** au cours du temps
  - **Attention** si les courbes se croisent !

**Cas de 2 populations ind√©pendantes**

Comparaison de 2 fonctions de survie: 
H0 : S1(t) = S2(t) ; H1 : S1(t) != S2(t)
**En absence de censure** : tests non param√©triques (Wilcoxon / Mann Whitney)
**En presence de censure**: extension des tests non param√©triques :
- Test du **log-rank** (cours 2, diapo 62...)
  - G√©n√©ralise le test du chi2 stratifi√© de Mantel et Haenszel
  - Synonyme du test de Mantel-Cox
  - Bas√© sur des tableaux de contigence 2x2 √† chaque temps de d√©c√®s, t(1) < t(2) ... t(k)
  - Statistique de Chi2 permet la comparaison des nombres de d√©cus obs ET attendus E(D1) sous H0
  - La puissance de ce test d√©pend du nombre d'event plus que du nb de sujets
    - Puisance max dans la famille alternative de Lehman c a d quand les risques sont **proportionnel** sinon c'est valide mais moins puissant (pex, quand les courbes se croisent)
    - Existe aussi des **log-rank pond√©r√©, stratifi√©, et comparaison de K groupes**
      - **Pond√©ration** (cours 2 diapo 67, a voir si n√©cessaire), le log-rank est le plus puissant dans la famille des hypoth√®ses alternatives avec proportionnalit√© des risques
      - **Stratifi√©** (cours 2 diapo 68, a voir si n√©cessaire), calcul sur chaque strate, s√©parement sur chaque strate puis somme les diff√©rences sur l'ensemble des strates. **Limite = perte de puissances si bcp de strates**
      - **Pour K groupes** suit un Chi2 a G-1 ddl. *Erreur fr√©quente* : comparer des groupes d√©finis dans le futur.
        - Que faire sinon ? Biais du d√©lai de r√©ponse (guarantee time bias) / Interpr√©tation non causale : facteur de **confusion** : alternative est de corriger le biais de l'estimater des fonctions de survie en changeant l'origine des temps / M√©thode de la borne (landmark Method) : origine = date tau (int√©r√™t lorsque d√©lai de r√©ponse au traitement est court (pex: cancer colorectaux) / **Alternative** : introduction d'un √©tat d√©pendant du temps dans un mod√®le de r√©gression
- Test de Wilcoxon
- Test de Gehan

**Expliquer la mortalit√© : Conclusion
- Limites:
  - Comparaison multiples
  - Non prise en compte d'eventuels facteurs de confusion
  
- **Int√©r√™t des mod√®les de regression**
  - Permet de **d√©crire la distribution d'une variable al√©atoire** en fonction de **param√®tres suppos√©s non al√©atoires**  
  
# Mod√®le de COX

Introduit la **vraisemblance partielle a.k.a maximum partial likelihood**

## Diff√©rence entre mod√®le de COX et Logistique

- **Taux d'incidence (risque)** : nb de nvx cas de maladie dans la population √† risque par unit√© de temps (ou taux de mortalit√© si le r√©sultat est la mort)
- **Incidence cumul√©e** : proportion de nvx cas survenus au cours d'une p√©riode donn√©e
- Mod√®le de **Cox estime des HR** : rapport des taux d'incidence
- Mod√®le **logistique estime des OR** : rapport de cotes

**Cox mod√©lise l'effet des covariables sur le taux de risque mais laisse le taux de risque de base non sp√©cifi√©**
- Ne suppose **PAS** la connaissance du risque absolu
- Estime le risque **relatif** plut√¥t qu'absolu
- Semiparam√©trique
- Peut prendre en charge des mesures **discr√®tes et continues** du temps d'**event**
- Facilit√© d'incorporation de covariables **d√©pendantes** du temps

## Hypoth√®ses, Expression, Estimation, Pr√©diction

- Mod√©lise la fonction de risque instantan√©, densit√© conditionnelle.

- Mod√®le SemiParam√©trique:
  - 1 partie non param√©trique
    - **fonction de risque de base h0(t) NON sp√©cifi√©e**
      - Positive (traduit le risque quand toutes les covar sont nulles)
  - 1 partie param√©trique
    - Influence des covar Zn sur le risque de base, mod√©lis√© par la fonction (log)lin√©aire. Z : vecteur des prdicteurs: variables continues, discr√®tes ou termes d'interaction.

**Risques proportionnels** : rapport des fonctions de risques de 2 indivs ne d√©pendent **pas du temps**.
- ***Constante*** **HR (hazard ratio)** : rapport des fonctions de risque instantann√©es. Les 2 fonctions de risque sont **parall√®les**. Effet des pr√©dicteurs constant dans le temps.

**Interpr√©tation de ùõΩ** cours 3. diapo 12...)

**COX est lin√©aire pour le log HR**

HR = log(ùõΩ)

![Plot title. ](Cours_SURVIE_insertimage_20.png)
![Plot title. ](Cours_SURVIE_insertimage_21.png)



**Lorsque temps d'event identiques "ties"**
- Plusieurs m√©thode, 1 seul event a chaque temps:
  - M√©thode discr√®te (COX)
    - Suppose que le temps = var discr√®te
      - Difficile si nombreux "ties"
  - M√©thode exacte (Prentice)
    - Les "ties" surviennent a cause de l'impr√©cision des mesures
    - Il y a donc un ordre inconnu des temps d'event
    - Calcul la proba de tous les ordres possibles pour les "ties"
    - Pas a privil√©gier car temps de calcul lourd
  - Approximation de Breslow
    - R√©duit temps de calcul de la m√©thode exact.
    - Mauvaise approx. quand bcp de "ties" par rapport au nb de sujets √† risues
  - **Approximation d'Efron**
    - A pr√©f√©rer quand bcp de "ties" par rapport au nb de sujet a risk.
    - **M√©thode utilis√©e par `coxph()`**
  
## Mod√®le STRATIFIE

Permet de consid√©rer des fonctions de risque de base diff√©rentes pour chacune des k strates

- On stratifie sur une variable cat√©gorielle √† **K classes**
- Les strates **r√©partissent les patients dans des groupes disjoints**
- Le taux de base est diff√©rent dans chaque strate mais **l‚Äôeffet des autres covariables est identique**

#### Avantages

- Permet un **ajustement naturel sur un facteur de confusion**
- Ne repose **pas sur l‚Äôhypoth√®se de proportionnalit√©** puisque 1 mod√®le par strate : **on peut stratifier sur un facteur dont effet d√©pend du temps**

#### Inconv√©nients
- **Pas d‚Äôestimation directe de l‚Äôeffet de la strate**
- **Pr√©cision** de l‚Äôestimation des coefficients et puissance de l‚Äôanalyse **diminuent avec le nombre de strates**


## COX
## V√©rifier les hypoth√®ses (Risque proportionnels, log lin√©arit√©, censure non informative)


1) Risques proportionnels
- Si √ßa n‚Äôest pas vrai :
  - on estime un effet moyen
  - On peut conclure √† tort √† l‚Äôabsence d‚Äôeffet
Si on trace log(‚àílog(ùëÜ(t)) pour chaque valeur de Z toutes les courbes doivent √™tre parall√®les (translat√©es verticalement)

![Plot title. ](Cours_SURVIE_insertimage_22.png)

Limites
- Approche graphique sujette √† interpr√©tation subjective, parfois difficile
- Ne s‚Äôapplique pas √† des pr√©dicteurs continus

**M√©thodes explicites**
Id√©e = mod√©lisation explicite d‚Äôune **d√©pendance au temps en introduisant un effet d√©pendant du temps**

**R√âSIDUS DE SCHOENFELD**
- test de Grambsch& Therneau
**utilise les r√©sidus de Schoenfeld**,
trace les r√©sidus selon une fonction du tempsùëî(ùë°)
**si pente non nulle : alors violation de PH**

![Plot title. ](Cours_SURVIE_insertimage_23.png)

2) Relation log lin√©aire entre pr√©dicteurs (non binaires) et risque

Si on mod√©lise √† tort un effet lin√©aire d‚Äôune variable continue
- Estimation biais√©e
- Possible conclusion √† tort √† l‚Äôabsence d‚Äôeffet
**R√©sidus de Martingale**
- Pour un individu i : Diff√©rence entre l‚Äôobservation de l‚Äô√©v√©nement ùõøùëñ√† ce qui est attendu conditionnellement au mod√®le test√©, √©valu√© par le taux cumul√© dans la population.
- **Permettent d‚Äô√©tudier la relation fonctionnelle entre une variable et le risque instantan√©**
- Si z a un effet de la forme f(z) alors ses r√©sidus sont approximativement proportionnels √† f(z)

![Plot title. ](Cours_SURVIE_insertimage_24.png)


3) Censure ind√©pendante (non informative)

- Formellement non testable (on n‚Äôobserve pas T et C ensemble)
- Li√©e au sch√©ma de l‚Äô√©tude et au contexte +++

# Performances = ?

## Calibration

**Calibration** 
Est-ce que pr√®s de x patients sur 100, avec une pr√©diction de risque de x %, ont le r√©sultat ?
- Capacit√© √† **pr√©dire** pr√©cis√©ment le **risque absolu** de l‚Äô√©v√©nement
- Propri√©t√© de type **"Goodness Of Fit [GOF]"**
- Expected vs Observed : par d√©cile de risque **pr√©dit**
  - Observed : non disponible pour censures
    - Estim√© par **KM maginal**
      - Test de Nam & d'Agostino
      - Puissance faible pour petit effectif, et trop puissant pour grand effectif
      - L'int√©r√™t est dans la courbe de **RE**calibration
![Plot title. ](Cours_SURVIE_insertimage_25.png)


## Discrimination

**Discrimination**
Les patients avec le r√©sultat ont-ils des pr√©dictions de risque plus √©lev√©es que ceux sans ?
- Capacit√© √† **ordonner correctement** les patients en **fonction de leur risque d‚Äô√©v√©nement**
- Sensibilit√©, Sp√©cificit√©, courbe ROC, AUC
- **Discrimination > calibration**
  - On peut recalibrer un mod√®le
  - Ind√©pendant de la calibration car statistique sur les rangs
  - Souvent pour les tests diagnostic

**Courbe ROC**
- Chaque seuil : TPR vs FPR (true positive rate vs false positive rate)
- AUC : entre 0 et 1; mais int√©ressant entre 0.5 et 1
- Interpr√©tation : probabilit√© d'ordonner correctement une paire malade, non malade
- AUC = 1 = discrimination parfaite, AUC = 0.5 = tirage au sort

### Lien avec les mod√®les de regression

Regression logistique
AUC = c-index
**Concordance entre pr√©dictions du mod√®le et observations**
- Capaciter de discrimination: **√† quel point les malades ont des probas pr√©dite de maladie plus √©lev√©s que les non malades.**

**Probl√®me** **#1 : comment d√©finir les ‚Äúmalades‚Äù**
- Temps d‚Äô√©v√©nement : Choix d‚Äôun temps t de mesure : AUC(t)
- Plusieurs d√©finitions des cas et des contr√¥les

AUC(T)
- CAS
  - Incidents : √©v√®nement au temps t
  - **Cumulatifs : √©v√®nement avant t**
- CONTROLES
  - Statiques : pas d‚Äô√©v√©nement sur un large suivi t*
  - **Dynamiques : pas d‚Äô√©v√©nement au temps t**

![Plot title. ](Cours_SURVIE_insertimage_26.png)


**Probl√®me #2 : comment g√©rer la censure ?**
Xi = min(Ti,Ci)
Plusieurs estimateursont √©t√© propos√©s
Heagerty, Lumley & Pepe(2000)
Uno & Wei (2011)...

**LIMITES**
Variabilit√© au coursdu temps
Ne capture qu‚Äôunepartie de l‚Äôinformation
AUC a un jour prcis : does not assess discrimination between patients


**Solution: AUC GLOBALE** : inclu dans `coxph` 
C-statistic :
- prends en compte partiellement la censure (paires non informative, Ci, Ti) des sujets. Biais> 0 qui augmente avec la censure.
Paires informatives (Ti, Tj) avec Ti< Tj
Paires concordantes (Ti<Tj) & (Xi>Xj)

# Estimation en pr√©sence de comp√©tition (risques comp√©titifs ou Censure informative)

Censure: a droie al√©atoire, la dur√©e d'obs Ci de censoure est al√©atoire. Suppose de plus que les variables de censure et de survie sont ind√©pendantes en probabilit√©s = censure non informative
Mod√©lisation avec COX a risques proportionnels: exp(Beta) = HR = cte
  - Risk set : ensemble de patient avec T > ti
Mod√©lise la fonction de risque instantann√© alpha(t)
Mod√®le semiParam√©trique

RELATION HAZARD <-> FONCTION DE SURVIE
Relation 1:1
1 - S(t) = F(t)
Direction de l‚Äôeffet d‚Äôune covariable sur le risque instantan√© <-> direction de l‚Äôeffet de la covariable sur la fonction de survie
- Direction identique mais pas valeur num√©rique

![Plot title. ](Cours_SURVIE_insertimage_27.png)

## Risque comp√©titif

### M√©thode de KM
**Pour √™tre valide, on doit supposer que les censures sont ¬´non informatives¬ª de la mortalit√©**


#### Comment mesurer une incidence cumul√©e en pr√©sence de ¬´censure informative¬ª ?

![Plot title. ](Cours_SURVIE_insertimage_28.png)
![Plot title. ](Cours_SURVIE_insertimage_29.png)

![Plot title. ](Cours_SURVIE_insertimage_30.png)

![Plot title. ](Cours_SURVIE_insertimage_31.png)

![Plot title. ](Cours_SURVIE_insertimage_32.png)

![Plot title. ](Cours_SURVIE_insertimage_33.png)

![Plot title. ](Cours_SURVIE_insertimage_34.png)

![Plot title. ](Cours_SURVIE_insertimage_35.png)

![Plot title. ](Cours_SURVIE_insertimage_36.png)

#### Biais de l‚Äôestimation classique en pr√©sence de comp√©tition

![Plot title. ](Cours_SURVIE_insertimage_37.png)

![Plot title. ](Cours_SURVIE_insertimage_38.png)

![Plot title. ](Cours_SURVIE_insertimage_39.png)

#### Censure ¬´informative¬ª et risques comp√©titifs
**Question √† se poser quand on censure**
- D√©c√®s avant rechute (Relapse-free interval)
  - Allogreffe dans le suivi
  - Arr√™ts de traitements protocolaires
  - Tout √©v√©nement au cours du suivi qui peut conduire √† un risque d‚Äô√©v√©nement modifi√©


#### Comparaison en pr√©sence de comp√©tition
**Comparaison de 2 groupes : log-rank invalide**
**Comparaison des fonctions d‚Äôincidence cumul√©e**
**Statistique de Gray** 

#### Mod√®les de r√©gression en pr√©sence de comp√©tition

Les 2 mod√®les les plus utilis√©s sont :
**Mod√®le de Cox cause-specifique**
  - Mod√©lise le **risque instantan√© cause-sp√©cifique**
  
  ![Plot title. ](Cours_SURVIE_insertimage_40.png)
  
  ![Plot title. ](Cours_SURVIE_insertimage_41.png)
  
  ![Plot title. ](Cours_SURVIE_insertimage_42.png)
  
  ![Plot title. ](Cours_SURVIE_insertimage_43.png)
  
**Mod√®le de Fine & Gray**
  - Mod√©lise le risque de sous-r√©partition

![Plot title. ](Cours_SURVIE_insertimage_44.png)

![Plot title. ](Cours_SURVIE_insertimage_45.png)

![Plot title. ](Cours_SURVIE_insertimage_46.png)

![Plot title. ](Cours_SURVIE_insertimage_47.png)

![Plot title. ](Cours_SURVIE_insertimage_48.png)

![Plot title. ](Cours_SURVIE_insertimage_49.png)

#### Que choisir ?

**Fine & Gray**
Int√©r√™t √©vident du mod√®le : lien direct entre SHR et effet sur la survenue (i.e. l‚Äôincidence cumul√©e) de l‚Äô√©v√©nement

Mais avec des limites :
- L‚Äôeffet d‚Äôune covariable sur l‚Äôincidence cumul√©e a la m√™me direction mais pas la m√™me valeur num√©rique que l‚Äôeffet sur le SH
- On peut comparer les effets de 2 variables sur l‚Äôincidence cumul√©e du m√™me √©v√©nement via leur SHR respectifs
- On ne peut pas comparer les effets d‚Äôune variable sur les incidences cumul√©es de deux √©v√©nements en comp√©tition via leurs SHR respectifs
- On ne peut pas comparer les effets d‚Äôune variable sur les incidences cumul√©es d‚Äôun m√™me √©v√©nement dans 2 √©tudes diff√©rentes via leurs SHR respectifs

- L‚Äôaspect ¬´artificiel¬ª du riskset n‚Äôemp√™che pas la validit√© du mod√®le
- La quantit√© mod√©lis√©e est le taux de survenue de l‚Äô√©v√©nement d‚Äôint√©r√™t chez les patients qui n‚Äôont pas fait d‚Äô√©v√©nement + ceux qui ont fait l‚Äô√©v√©nement en comp√©tition (parfois difficile √† expliquer)
- Int√©r√™t pour une **mod√©lisation pronostique/pr√©dictive d‚Äôun √©v√©nement, et/ou des probl√©matiques d‚Äôallocation de ressources**


**Mod√®le Cause-specific**
Limite √©vidente :
- pas de lien direct entre csHRket effet sur la probabilit√© (Incidence cumul√©e) de l‚Äô√©v√©nement k

- M√™me s‚Äôil est possible de reconstruire les incidences cumul√©es √† partir de tous les csHR(et tous les risques de base)
- La quantit√© mod√©lis√©e a plus de sens : taux de survenue de l‚Äô√©v√©nement d‚Äôint√©r√™t chez les patients qui n‚Äôont encore fait aucun √©v√©nement
Int√©r√™t pour une **mod√©lisation √† but √©tiologique**

When analyzing survival data in which **competing risks are present**, rather than beginning with a predetermined type of regression model, the investigator and analyst should **begin by carefully formulating the research question and then selecting the model** that is most appropriate for addressing the formulated question. In many instances, particularly in **epidemiological research, the most appropriate model will be the cause‚Äêspecific hazard model**. However, in **settings in which it is important to make inferences about the effect of covariates on the incidence of the outcome, then the Fine‚ÄêGray model will be the most appropriate model**. Some authors have suggested that to develop a **greater understanding of the relationship between covariates and outcomes, that both cause‚Äêspecific and subdistributionhazard models be fit, for both the primary outcome and for the competing events**.When doing so, the principal message of the current study is that the regression coefficients from the subdistributionhazard model must be interpreted correctly